**First Steps with MiniNetFED**

## Cloning the MiniNetFED Repository

```python
git clone https://github.com/lprm-ufes/MininetFed.git
```

## Prerequisites

### Installing Docker Engine

Access the official documentation and follow the steps for installing Docker Engine:

https://docs.docker.com/engine/install/ubuntu/#install-using-the-repository

### Installing ContainerNet

MiniNetFED requires ContainerNet. Before installing it, install its dependencies using the following command:

```python
sudo apt-get install ansible git aptitude
```

#### Tested Version of ContainerNet (Recommended)

The version used of ContainerNet is in a .zip file in the **containernet** directory of the MiniNetFED repository. Copy this .zip file and paste it where you want to install ContainerNet on your machine

> #### Other Versions (Not Recommended)
>
> If you want to install ContainerNet from other sources, it can be found in the following repositories
>
> ##### Official
>
> ```
> git clone https://github.com/containernet/containernet
> ```
>
> Make sure that the installation method is "Bare-metal installation" for MiniNetFED to work correctly.
> The steps for installing this version can be found at: https://containernet.github.io/
> After installation, skip to the step _Generating Docker Images_
>
> ##### Alternative
>
> ```
> git clone https://github.com/ramonfontes/containernet.git
> ```

#### Installation Script (If You're Installing the Recommended Version)

Once you've chosen a location for installation, clone or decompress the containernet files and follow these commands

```
cd containernet
```

```
sudo util/install.sh -W
```

## Generating Docker Images

MiniNetFED also depends on some pre-configured Docker images.

Use the following commands to create these images:

```
cd MininetFed
```

```
sudo docker build --tag "mininetfed:broker" -f docker/Dockerfile.broker .
sudo docker build --tag "mininetfed:client" -f docker/Dockerfile.container .
```

"mininetfed:broker" and "mininetfed:client" are the names of the images.

## Creating the Environment with Dependencies

The following command runs a script that creates a **python** environment and installs standard dependencies and those necessary for example Trainers. This environment is used by clients and servers:

```
sudo python3 scripts/create_env.py mininetfed:client scripts/requirements.txt
```

The following command creates the **env_analysis** which will be used later to analyze results generated by an experiment

```
./scripts/env_analysis.sh
```

# Running MiniNetFED with an Example

To test whether everything is working correctly, you can run one of the configuration files in the **exemplos** directory. Choose an example from the folder and modify the config.yaml file to change the key n_available_cpu: to the number of logical cores available on your machine.

```
general:
  n_available_cpu: <number_of_logical_cores>
  (...)
```

After this modification, modify and run the following command

```
sudo python3 main.py examples/<example_name>/config.yaml
```

> ### Example Trainer Har with fed_sec_per and fed_avg
>
> ```
> sudo python3 main.py examples/har_fed_sec_per/config.yaml
> ```

If everything is working correctly, the experiment should start running by opening the following windows:

- Broker MQTT
- Server
- Network Monitor
- N clients, where N is the number of clients in the experiment

After the experiment has finished running, a new folder should be created inside **experiments** containing the results of the experiment.

# Analyzing the First Experiment

Inside the example folder, there is the analysis.yaml file. To run it, first activate the python environment from the analysis script:

```
. env_analysis/bin/activate
```

Modify and run the following command:

```
python3 analysis.py examples/<example_name>/analysis.yaml
```

> ### Example Trainer Har with fed_sec_per and fed_avg
>
> ```
> python3 analysis.py examples/har_fed_sec_per/analysis.yaml
> ```